swagger: '2.0'
info:
  title: Orchestration Service API
  description: API Gateway for Orchestration Service (via Proxy Service)
  version: 1.0.0
host: orchestration-api-gateway
schemes:
  - https
produces:
  - application/json
paths:
  /api/v1/companies/search:
    get:
      summary: Search companies
      operationId: searchCompanies
      parameters:
        - in: header
          name: Authorization
          type: string
          required: true
          description: Supabase JWT token (will be overwritten by API Gateway with identity token)
        - in: header
          name: X-Supabase-Token
          type: string
          required: true
          description: Supabase JWT token (preserved by API Gateway, used by proxy service)
        - name: query
          in: query
          required: true
          schema:
            type: string
          description: Company name or search query
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            default: 10
          description: Maximum number of results to return
      x-google-backend:
        address: ${proxy_service_url}
        path_translation: APPEND_PATH_TO_ADDRESS
        protocol: h2
        jwt_audience: ${proxy_service_url}
      responses:
        '200':
          description: Success
          schema:
            type: object
            properties:
              companies:
                type: array
              count:
                type: integer
  /{path=**}:
    get:
      operationId: orchestrationGet
      parameters:
        - in: header
          name: Authorization
          type: string
          required: true
          description: Supabase JWT token (will be overwritten by API Gateway with identity token)
        - in: header
          name: X-Supabase-Token
          type: string
          required: true
          description: Supabase JWT token (preserved by API Gateway, used by proxy service)
        - name: path
          in: path
          required: true
          type: string
      x-google-backend:
        address: ${proxy_service_url}
        path_translation: APPEND_PATH_TO_ADDRESS
        protocol: h2
        jwt_audience: ${proxy_service_url}
      # API Gateway adds Authorization header with identity token for Cloud Run IAM
      # Proxy service extracts Supabase JWT from Authorization and forwards as X-User-Token
      # Proxy service uses its own identity token for Cloud Run IAM to orchestration service
      responses:
        '200':
          description: Success
    post:
      operationId: orchestrationPost
      parameters:
        - in: header
          name: Authorization
          type: string
          required: true
          description: Supabase JWT token (will be overwritten by API Gateway with identity token)
        - in: header
          name: X-Supabase-Token
          type: string
          required: true
          description: Supabase JWT token (preserved by API Gateway, used by proxy service)
        - name: path
          in: path
          required: true
          type: string
      x-google-backend:
        address: ${proxy_service_url}
        path_translation: APPEND_PATH_TO_ADDRESS
        protocol: h2
        jwt_audience: ${proxy_service_url}
      responses:
        '200':
          description: Success
    put:
      operationId: orchestrationPut
      parameters:
        - in: header
          name: Authorization
          type: string
          required: true
          description: Supabase JWT token (will be overwritten by API Gateway with identity token)
        - in: header
          name: X-Supabase-Token
          type: string
          required: true
          description: Supabase JWT token (preserved by API Gateway, used by proxy service)
        - name: path
          in: path
          required: true
          type: string
      x-google-backend:
        address: ${proxy_service_url}
        path_translation: APPEND_PATH_TO_ADDRESS
        protocol: h2
        jwt_audience: ${proxy_service_url}
      responses:
        '200':
          description: Success
    delete:
      operationId: orchestrationDelete
      parameters:
        - in: header
          name: Authorization
          type: string
          required: true
          description: Supabase JWT token (will be overwritten by API Gateway with identity token)
        - in: header
          name: X-Supabase-Token
          type: string
          required: true
          description: Supabase JWT token (preserved by API Gateway, used by proxy service)
        - name: path
          in: path
          required: true
          type: string
      x-google-backend:
        address: ${proxy_service_url}
        path_translation: APPEND_PATH_TO_ADDRESS
        protocol: h2
        jwt_audience: ${proxy_service_url}
      responses:
        '200':
          description: Success
